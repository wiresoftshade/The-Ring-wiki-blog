## 2 Модель микрограней

Мы определим нашу BRDF и сравним с измеренными материалами в терминах модели микрограней [^30], [^7], [^33]. Модель микрограней постулирует, что если поверхностное отражение может происходить между заданным вектором света $\mathbf{l}$ и вектором взгляда $\mathbf{v}$, ​​то должна существовать некоторая часть поверхности, или микрогрань, с нормалью, выровненной посередине между векторами $\mathbf{l}$ и $\mathbf{v}$. Этот «половинный вектор», иногда называемый нормалью микроповерхности. Таким образом, определяется как $\mathbf{h} = \frac{\mathbf{l}+\mathbf{v}}{|\mathbf{l}+\mathbf{v}|}$. Общая форма модели микрограней для изотропных материалов:

[^7]: Р. Л. Кук и К. Э. Торранс. Модель отражения для компьютерной графики. *Компьютерная графика*, 15(3):307–316, 1981. / R. L. Cook and K. E. Torrance. A reflectance model for computer graphics. *Computer Graphics*, 15(3):307–316, 1981.

[^30]: К. Торранс и Э. Спарроу. Теория незеркального отражения от шероховатых поверхностей. *Журн. Оптического общ. Америки*, 57:1105–1114, 1967 г. / K. Torrance and E. Sparrow. Theory for off-specular reflection from roughened surfaces. *J. Optical Soc. America*, 57:1105–1114, 1967.

[^33]: Брюс Уолтер, Стивен Р. Маршнер, Хонгсонг Ли и Кеннет Э. Торранс. Модели микрограней для преломления через шероховатые поверхности. *В трудах симпозиума Eurographics по рендерингу*, 2007. / Bruce Walter, Stephen R. Marschner, Hongsong Li, and Kenneth E. Torrance. Microfacet models for refraction through rough surfaces. In *Proceedings of the Eurographics Symposium on Rendering*, 2007.

$$f (\mathbf{l}, \mathbf{v}) = \text{diffuse} + \frac{ D(θ_h)F(θ_d)G(θ_l, θ_v) }{ 4\cosθ_l \cosθ_v}$$

Диффузный член — это функция неизвестной формы. Диффузный Ламберт часто предполагается и представляется постоянным значением. Для зеркального члена $D$ — это функция распределения микрограней, которая отвечает за форму зеркального пика, $F$ — коэффициент отражения Френеля, а $G$ — геометрический коэффициент затухания или затенения.

$θ_l$ и $θ_v$ — углы падения векторов $\mathbf{l}$ и $\mathbf{v}$ относительно нормали, $θ_h$ — угол между нормалью и половинным вектором, а $θ_d$ — угол «разницы» между $\mathbf{l}$ и половинным вектором (или, симметрично, $\mathbf{v}$ и $\mathbf{h}$).

Большинство физически правдоподобных моделей, не описанных специально в форме микрограней, все равно могут быть интерпретированы как модели микрограней, поскольку у них есть функция распределения, фактор Френеля и некоторый дополнительный фактор, который можно считать геометрическим фактором затенения. Единственное реальное различие между моделями микрограней и другими моделями заключается в том, включают ли они явный фактор $\frac{1}{4\cosθ_l\cosθ_v}$, который исходит из вывода микрограней. Для моделей, которые не включают этот фактор, подразумеваемый фактор затенения может быть определен путем умножения модели на ${4\cosθ_l\cosθ_v}$ после вынесения факторов $D$ и $F$.